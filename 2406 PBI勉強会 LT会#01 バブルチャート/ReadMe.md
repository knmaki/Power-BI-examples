# 0. はじめに
## 0.1. これは何？
Power BI LT 会 1で発表した内容。バブル チャートを使ってみた話。発表の機会を与えていただいたPower BI 勉強会に感謝。

https://powerbi.connpass.com/event/321437/

![全体](https://github.com/user-attachments/assets/c1c4864d-a699-4f29-8db6-da49251b66ab)


## 0.2. Power BI 勉強会とは
楽しいところです。

https://powerbi.connpass.com/

## 0.3. サンプルファイルの開き方
サンプルファイルは[こちら](https://github.com/knmaki/Power-BI-samples/tree/main/2406%20PBI%E5%8B%89%E5%BC%B7%E4%BC%9A%20LT%E4%BC%9A%2301%20%E3%83%90%E3%83%96%E3%83%AB%E3%83%81%E3%83%A3%E3%83%BC%E3%83%88)の `2406 PBI勉強会 LT会#01 バブルチャート.pbip` 。

プレビュー段階のPower BI Desktop プロジェクト（ `.pbip` ファイル）を使用しているので、プレビュー機能を有効にする必要あり。

https://learn.microsoft.com/ja-jp/power-bi/developer/projects/projects-overview

# 2. バブル チャートとは
まずはMS Learnより。バブル チャートは散布図ビジュアルから作るとのこと。

https://learn.microsoft.com/ja-jp/power-bi/visuals/power-bi-visualization-scatter?tabs=powerbi-desktop


余談。散布図ビジュアルはちょっと特殊なやつで、以下の3つのチャートに対応している。ビルド ペインでの列項目やメジャーの設定方法によって、どのチャートになるかが変わる。
- **散布図** : ２つの観測値の関係性を表す。分布そのものを見るので、最も基本的な分析。BIの世界ではあまり縁がないが、データ サイエンスだと、3つ以上の変数があればまずは散布図行列を見てみる（Power BIでやるならPythonかRビジュアルで）。
- **バブル チャート** : 3つの観測値の関係性を表す。しっかり観測値を吟味すれば、面白い結果が見えることも。ファクトフルネスって本で出てた。
- **ドット プロット チャート** : 横軸が数字じゃなくてカテゴリーになっている散布図。FOMCのドット チャートが有名（他知らない）。

# 3. バブル チャートを作ってみる

## 3.1. セマンティック モデルの説明
ファクト テーブルとして、都道府県別の人口、面積、県内総生産などの統計データ、ディメンション テーブルとして都道府県の分類の2つのテーブルが主。あとは、ビジュアル用のフィールド パラメーター。

![モデル ビュー](https://github.com/user-attachments/assets/d91a7ae1-7171-4a6d-9fa8-70b66f1e2959)

なお、数字はCopilot先生に作ってもらったもの。正確かどうかは確認していないので注意。


## 3.2. ビルド ペインの各項目の説明とできあがり
以下はバブル チャート作成時の項目の使い方。他のチャートの場合は異なるので注意。

![ビルド ペイン](https://github.com/user-attachments/assets/80d185f3-942d-44da-a66d-b31d8da5bc66)

（ `ヒント` が切れてる。。）

|項目名|説明|設定値|
|:-|:-|:-|
|**値**|データ ポイントの粒度。複数設定することで、ドリルダウンが可能。|都道府県の階層（地方区分）|
|**X軸**|X軸用のメジャー。|人口|
|**Y軸**|Y軸用のメジャー。|面積|
|**凡例**|バブルの色分け用の分類。|地方区分のフィールド パラメーター|
|**サイズ**|バブルのサイズ。|県内総生産|
|**再生軸**|バブル チャートの推移をみるときの時間軸。|なし|
|**ヒント**|マウス カーソルを当てた時に表示される付加情報。|平均寿命|

で、出来たのが次のチャート（都道府県単位にドリル ダウン済み）。良い感じな気がする。

![バブル チャート](https://github.com/user-attachments/assets/aff03e3f-25cb-46da-a2e5-7babe18623de)


## 3.3. ビジュアルをテーブルで見てみる
X軸もY軸もメジャーなのは不思議な気がしたが、テーブルを見ると何となく納得。行見出しが、**凡例** と **値** で指定したディメンションの階層になっていたりとかも確かにと思わせられる。

![テーブル表示](https://github.com/user-attachments/assets/866d2181-dba8-4952-b9fb-25d571a15e0d)

## 3.4. ドリル アップ/ダウンが面白い
ビジュアルの右上に出てくるが、あんまり役に立つイメージがないドリル ダウン等であるが、バブル チャートの場合はまあまあ面白い。

![ドリルダウンアイコン_50pct](https://github.com/user-attachments/assets/b10fe2ea-dfc9-4d5e-ade9-298bcf03eedd)


### 階層内の次のレベルに移動
`↓↓` アイコンの「階層内の次のレベルに移動します」で遊んでみると。こんな感じ。

- 第一階層（地方2区分）------ ![バブル チャート_第一階層](https://github.com/user-attachments/assets/cff42029-d796-4e63-89e0-9d77e24ef81a)
- 第二階層（地方7区分）------ ![バブル チャート_第二階層](https://github.com/user-attachments/assets/81d04f1c-79b3-48cf-b093-c5c8f1877880)
- 第三階層（都道府県）------ ![バブル チャート_第三階層](https://github.com/user-attachments/assets/3c8bb578-45de-44e3-b04a-07dec97f25c6)


### ドリル ダウン
`↓` アイコンをクリックして、ドリル ダウンを有効化する。

バブルをクリックすると、どんどん分解される。おお、分析している感が出てきて気持ちいい。

- 第一階層（地方2区分）の東日本をクリック------ ![バブル チャート_ドリルダウン_第一階層](https://github.com/user-attachments/assets/5d49e8aa-560a-4012-a20a-e4ef0fd41d5d)
- 第二階層（地方7区分）の中部をクリック------ ![バブル チャート_ドリルダウン_第二階層](https://github.com/user-attachments/assets/66a87f06-7f6b-4f9b-bcf8-aa24c3a8cd01)
- 第三階層（都道府県）------ ![バブル チャート_ドリルダウン_第三階層](https://github.com/user-attachments/assets/145baa09-aaf7-4ce5-b564-97f56ecf25c6)




## 3.5. フィールド パラメーターで工夫
凡例にフィールド パラメーターをセットすると、値のドリルダウンに合わせてバブルの色分けを変更可能。工夫すればさらに意味付けられたチャートに。
- 地方2区分で色分け------ ![バブル チャート_FP1](https://github.com/user-attachments/assets/31c8160b-1df9-424d-85a0-116bfa9922fe)
- 地方7区分で色分け------ ![バブル チャート_FP2](https://github.com/user-attachments/assets/26aa42b0-8a2e-4a80-b45b-f6d2f8d12bea)

と言っても、色分けは4つ以下なら見やすいけれど、5つだと微妙で、6つ以上ならやらない方がマシかな。←「個人の感想です。効果には個人差があります。」

# 4. バブル チャートの他の使い方
商品ごとの売上と費用のデータを用意し、X軸を費用、Y軸を売上とする散布図を作成。その解釈は：
- 45°線（対称網掛け）の上側にいれば、利益が出ているということ。
- 傾きが急なら利益率が高い。
- バブルのサイズを一人当たりの利益にすれば、人的資本の効率性も評価可能。


# 5. 思ったこと
LT会発表時に準備した資料は簡素だったけれど、記事に直すとまあまあ大変だった。せっかくまとめたので、今度社内勉強会で使うことにしよう。


